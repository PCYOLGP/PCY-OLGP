import{b as h,i as d}from"./chunk-6LSECYII.js";import{n as a}from"./chunk-O65HS32C.js";import{G as m,K as c,P as o,fa as f,k as g,l as p,o as u,pa as I,x as n}from"./chunk-IWLHDEFP.js";var U={production:!1,apiUrl:"/api"};var v=class l{platformId=o(I);router=o(d);http=o(h);apiUrl=U.apiUrl;_isLoggedIn=f(this.getInitialLoginState());isLoggedIn=this._isLoggedIn.asReadonly();_currentUser=f(this.getInitialUser());currentUser=this._currentUser.asReadonly();getInitialLoginState(){return a(this.platformId)?localStorage.getItem("isLoggedIn")==="true":!1}getInitialUser(){if(a(this.platformId)){let t=localStorage.getItem("user");if(t)return JSON.parse(t);if(localStorage.getItem("isLoggedIn")==="true"){let e={id:1,username:"user"};return localStorage.setItem("user",JSON.stringify(e)),e}}return null}login(t,e){return this.http.post(`${this.apiUrl}/login`,{username:t,password:e}).pipe(u(r=>r?(a(this.platformId)&&(localStorage.setItem("isLoggedIn","true"),localStorage.setItem("user",JSON.stringify(r))),this._currentUser.set(r),this._isLoggedIn.set(!0),!0):!1),n(()=>g(!1)))}logout(){a(this.platformId)&&(localStorage.removeItem("isLoggedIn"),localStorage.removeItem("user")),this._isLoggedIn.set(!1),this._currentUser.set(null),this.router.navigate(["/login"])}updateProfile(t,e){return this.http.patch(`${this.apiUrl}/users/${t}`,e).pipe(m(r=>{let i=this._currentUser();i&&i.id===r.id&&(localStorage.setItem("user",JSON.stringify(r)),this._currentUser.set(r))}),n(r=>(console.error("Update profile error:",r),p(()=>r))))}uploadProfileImage(t,e,r){let i=new FormData;return i.append("username",e),i.append("image",r),this.http.post(`${this.apiUrl}/users/${t}/profile-image`,i).pipe(m(s=>{localStorage.setItem("user",JSON.stringify(s)),this._currentUser.set(s)}),n(s=>(console.error("Profile image upload error:",s),p(()=>s))))}getUserByUsername(t){return this.http.get(`${this.apiUrl}/users?username=${t}`).pipe(u(e=>e.length>0?e[0]:null),n(()=>g(null)))}static \u0275fac=function(e){return new(e||l)};static \u0275prov=c({token:l,factory:l.\u0275fac,providedIn:"root"})};export{U as a,v as b};
