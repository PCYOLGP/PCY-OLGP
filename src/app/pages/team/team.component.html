<section class="directory-page animate-fade-in">
    <div class="container">
        <header class="directory-header text-center">
            <a routerLink="/about" class="back-link">‚Üê Back to About</a>
            <h1>PCY Directory</h1>
            <p>Meet the dedicated members of the Parish Commission on Youth.</p>
        </header>

        <!-- Search & Filter Bar -->
        <div class="directory-controls">
            <div class="search-box">
                <i class="ri-search-line"></i>
                <input type="text" [(ngModel)]="searchTerm" placeholder="Search by name, role or address..."
                    class="search-input">
            </div>
            <div class="year-filters">
                <div class="custom-dropdown">
                    <button class="dropdown-trigger" (click)="toggleYearDropdown()"
                        [class.active]="isYearDropdownOpen()">
                        <span>{{ selectedYear() === 'all' ? 'All Years' : selectedYear() }}</span>
                        <i class="ri-arrow-down-s-line trigger-icon"></i>
                    </button>

                    <div class="dropdown-menu" *ngIf="isYearDropdownOpen()">
                        <div class="dropdown-item" (click)="selectYear('all')"
                            [class.selected]="selectedYear() === 'all'">
                            All Years
                        </div>
                        <div *ngFor="let year of availableYears()" class="dropdown-item" (click)="selectYear(year)"
                            [class.selected]="selectedYear() === year">
                            {{ year }}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="directory-grid">
            <div *ngFor="let member of filteredMembers()" class="member-item animate-slide-up"
                (click)="showMemberDetails(member)">
                <div class="member-image-container">
                    <img [src]="member.image" [alt]="member.name" class="member-photo">

                    <!-- Tooltip logic -->
                    <div class="member-tooltip">
                        <span class="tip-role">{{ member.role }}</span>
                        <h4 class="tip-name">{{ member.name }}</h4>
                        <p class="tip-info" *ngIf="member.previousPosition">Prev: {{ member.previousPosition }}</p>
                        <p class="tip-info" *ngIf="member.age">{{ member.age }} years old</p>
                        <p class="tip-info" *ngIf="member.address">{{ member.address }}</p>
                    </div>
                </div>
                <div class="member-details">
                    <h3 class="member-name">{{ member.name }}</h3>
                </div>
            </div>
        </div>

        <!-- Full Modal -->
        <div class="modal-overlay" *ngIf="selectedMember() as member" (click)="closeModal()">
            <div class="modal-container animate-fade-in" (click)="$event.stopPropagation()">
                <button class="modal-close" (click)="closeModal()">
                    <i class="ri-close-line"></i>
                </button>

                <div class="modal-content-layout">
                    <div class="modal-image-side">
                        <img [src]="member.image" [alt]="member.name">
                    </div>
                    <div class="modal-info-side">
                        <span class="modal-role">{{ member.role }}</span>
                        <h2 class="modal-name">{{ member.name }}</h2>

                        <div class="modal-meta-grid">
                            <div class="meta-item" *ngIf="member.age">
                                <span class="meta-label">Age</span>
                                <span class="meta-value">{{ member.age }}</span>
                            </div>
                            <div class="meta-item" *ngIf="member.address">
                                <span class="meta-label">Address</span>
                                <span class="meta-value">{{ member.address }}</span>
                            </div>
                            <div class="meta-item" *ngIf="member.previousPosition">
                                <span class="meta-label">Previous position</span>
                                <span class="meta-value">{{ member.previousPosition }}</span>
                            </div>
                        </div>

                        <div class="modal-bio" *ngIf="member.bio">
                            <h3>About</h3>
                            <p>{{ member.bio }}</p>
                        </div>

                        <div class="modal-footer-actions">
                            <a [href]="member.fb" target="_blank" class="modal-btn fb" *ngIf="member.fb">
                                <i class="ri-facebook-circle-fill"></i>
                                Message on Facebook
                            </a>
                            <a [href]="'mailto:' + member.email" class="modal-btn mail" *ngIf="member.email">
                                <i class="ri-mail-fill"></i>
                                Send Email
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div *ngIf="team().length === 0" class="empty-state text-center">
            <div class="empty-icon">üìá</div>
            <p>No members found in the directory.</p>
        </div>
    </div>
</section>